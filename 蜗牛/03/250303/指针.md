## 指针基础

### 课程目标

1. 为什么需要指针
2. 指针的概念
3. 指针的基本使用
   1. **取值符**
   2. **解引用**

4. 应用：**指针运算和遍历**
5. 特殊指针（理解）
6. 指针基本技巧（优化）
7. 结构体中的指针
8. 函数中的指针
9. 多级指针

### 课程实验

1. 指针的定义、赋值、解引用
2. 指针运算：数组指针遍历、计算两个`指针`之间的距离（数据个数）、比较指针大小。
3. 函数中传递指针：基本类型数据、数组、结构体
4. 结构体指针使用。箭头语法:`->`

### 课堂引入

指针是C语言的重要概念，也是C语言及其扩展语言（C++等）的重要特色。指针可以使程序变得简洁、 紧凑、高效。每一个学习C语言的人都应当深入学习和掌握指针。可以说，**没有掌握指针，就是没有学 会C语言**。 指针的概念复杂也比较灵活，因此初学者经常会犯错。请同学们务必多思考、多练习、谨慎使用

那为什么指针如此重要：

![image-20240418221304074](https://woniumd.oss-cn-hangzhou.aliyuncs.com/web/dengnaiwen/20240418221304.png)

### 函数参数问题：

#### 零：入门案例：

> 当我们在函数中修改了参数的值时，发现main函数里的值并没有改变。

值未改变示例：

``` c
/***************************************************
# File Name:    指针01-初识.c
# Author:       SuperYu
# Mail:         yujian001002@163.com.com
# Created Time: 2024年10月17日 星期四 17时45分42秒
****************************************************/

#include <stdio.h>
#include <stdbool.h>
#include <string.h>
 
// 定义一个结构体
struct Student{
	char name[32];
	int age;
};

// 申明函数
void editInt(int);

void editStudent(struct Student);

int main() {
	// 测试int值：
	int num = 100;
	// 调用函数改变int的值
	editInt(num);
	printf("main函数内的值：%d \n",num);	

	// 测试结构体
	struct Student s = {"jack",22};
	// 调用函数,改变结构体的值
	editStudent(s);
	
	printf("main里面 -> 名字:%s , 年龄:%d \n", s.name, s.age);	

    return 0;
}

void editInt(int num){
	num *= 2;
	printf("函数内值%d: \n",num);	
}

void editStudent(struct Student s){
	strcpy(s.name, "rose");
	s.age = 19;
	printf("函数内 -> 名字:%s , 年龄:%d \n", s.name, s.age);	
}
```

使用指针可以解决这个问题：

指针示例：

> 我们发现，当参数是指针时，在函数里修改了参数的值，main函数里相应变量的值也发生的改变。

``` c
/***************************************************
# File Name:    指针02-参数是指针.c
# Author:       SuperYu
# Mail:         yujian001002@163.com.com
# Created Time: 2024年10月17日 星期四 17时45分42秒
****************************************************/

#include <stdio.h>
#include <stdbool.h>
#include <string.h>
 
// 定义一个结构体
struct Student{
	char name[32];
	int age;
};

// 申明函数
void editInt(int *);

void editStudent(struct Student *);

int main() {
	// 测试int值：
	int num = 100;
	// 调用函数改变iint的值，传递的是指针
	editInt(&num);
	printf("main函数内的值：%d \n",num);	

	// 测试结构体
	struct Student s = {"jack",22};
	// 调用函数,改变结构体的值,传递的是指针
	editStudent(&s);
	
	printf("main里面 -> 名字:%s , 年龄:%d \n", s.name, s.age);	

    return 0;
}

void editInt(int *num){
	*num *= 2;
	printf("函数内值%d: \n", *num);	
}

void editStudent(struct Student *s){
	//strcpy((*s).name, "rose");
	strcpy( s->name, "rose");  //　使用指针的 -> 方式访问结构体成员，更简洁

	//(*s).age = 19;
	s->age = 19;

//	printf("函数内 -> 名字:%s , 年龄:%d \n", (*s).name, (*s).age);	
	printf("函数内 -> 名字:%s , 年龄:%d \n", s->name, s->age);	

}

```

以上都和地址有关系，而程序中的地址可以通过**指针**来操作。



#### 一、指针基础

##### 1、指针的基本概念

**内存地址**：在计算机内部存储器（简称内存）中，每一个字节单元（8位），都有一个编号，称为地址。（在32位计算机中，地址是由32位（bit）构成的2进制数，占4字节（byte），通常由一个8位的16进制数来表示。）

**指针**：在C语言中，专门用来保存**内存地址**的变量，称为“指针变量”，简称“指针”。在不影响理解的前提下，“指针”、“指针变量”和“地址”不做区分，统称“指针”(在c语言中)。

**指针的目标**：指针的目标变量简称为指针的目标。指针变量用于存放该对象（也可以理解为就是一块内存区域）的首地址。指针的目标就是指地址所指空间保存的数据。

![image-20240229150946396](https://woniumd.oss-cn-hangzhou.aliyuncs.com/web/dengnaiwen/image-20240229150946396.png)

强化理解（Windows的快捷方式）：

![image-20240418142312416](https://woniumd.oss-cn-hangzhou.aliyuncs.com/web/dengnaiwen/20240418142312.png)



解理图示：

- ![image-20241017233144484](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/yujian/20241017233144.png)

总结：每个指针在内存都会占据8个字节的空间，这部分空间可以保存另一个数据的内存**地址**。



##### 2、指针基础语法

用法：

```c
<数据类型名> *<指针变量名>;
```

说明：
<数据类型名>：指针指向的数据类型，是指针的目标的数据类型，而非指针本身的数据类型
< 指针变量名 > ：指针变量的变量名。前面加 代表这是一个指针变量
示例：

```c
char *s; //定义一个指向char类型数据的指针变量s

int *p; //定义一个指向int类型数据的指针变量p

float *f; //定义一个指向float类型数据的指针变量f
```

<font color='red'>注意：</font>在C语言的官方文档内，推荐定义指针时指针运算符" * "要紧贴指针变量名，而不要挨着数据类
型名,为推荐写法。

指针本身没有类型，固定大小，**声明指针用的数据类型是 指针指向空间保存数据的类型**



##### 3、指针变量的引用

（1）指针关联的运算符

> 在这里需要熟练掌握两个与指针有关的运算符：& 和 *

- &：取地址运算符: scanf("%d", &num);

- *：获取指针保存地址指向空间的数据（或称“间接访问运算符”），又称指针的**解引用**运算符

> 两个运算符互为逆运算。例如”&a”就是取变量a的地址，而”\*b” 就是取指针变量 b 所指向的内存单元里的内容。通过一个 \*指针访问它所指向的对象的值称为变量的 “间接访问”。

示例代码：

``` c
/***************************************************
# File Name:    指针03-指针相关符号.c
# Author:       SuperYu
# Mail:         yujian001002@163.com.com
# Created Time: 2024年10月17日 星期四 17时45分42秒
****************************************************/

#include <stdio.h>
#include <stdbool.h>
#include <string.h>

int main() {
	int a = 99;
	// 把变量a的内存地址赋值给指针变量p
	int *p = &a;
	//这打印出的值是一样的
	printf("变量a的地址是：%p \n",&a);
	printf("指针p的地址是：%p \n", p);

	// 使用解引用符号 * ，得到指针p 的指针目标的值
	printf("指针p的目标的值是：%d \n", *p);

	// 代表没有指向任何引用, 可以这样初始化指针变量
	int *x = NULL;
	x = p;
	printf("指针x的目标的值是：%d \n", *x);

    return 0;
}
```

（2）引用

- 给指针变量赋值

  ```c
  int a;
  int *p;//默认不指向任何空间，需要手动赋值，通过&来赋值
  p = &a;//将a的地址取出赋值给指针变量p
  ```

- 指针变量的初始化

  我们可以在定义指针变量的时候对指针变量进行初始化。如：

  ```c
  int *p = &a; //初始化指针变量p指向变量a
  或
  int *p = NULL; // 代表没有指向任何引用, 可以这样初始化指针变量
  ```

- 引用指针变量所指向的内容（**又称为解引用**）

  如果已执行p = &a，表示指针p已指向变量a，则我们可以使用指针p来引用变量a。如：

  ```c
  printf("%d\n",*p); //p表示将指针变量p的内容取出
  或者可以通过指针对指向的变量进行操作。如：
  *p = 1;//相当于a = 1
  printf("%d",a);
  printf('%d',*p);
  ```

- 引用变量本身的内容

  指针变量也是可以输出的，用格式控制%p,如：

  ```c
  printf("%p",p); //打印指针p所存放的地址,也就是变量a空间的地址
  //用变量a来得到同一个地址
  printf("%p",&a);
  ```

- 指针变量占内存空间大小

  指针变量存储的是一个32位2进制数（8位16进制数），因此占内存4字节, 64位系统则可能为8个字节。指针变量本身保存地址的大小是固定的，只跟系统本身有关系，**跟指针的数据类型没有关系**

  

4、代码示例

```c
/***************************************************
# File Name:    指针04-指针的大小.c
# Author:       SuperYu
# Mail:         yujian001002@163.com.com
# Created Time: 2024年10月17日 星期四 23时45分42秒
****************************************************/

#include <stdio.h>
#include <stdbool.h>
#include <string.h>

int main() {
	// int 型测试	
	int a = 99;
	int *p = &a;
	//这打印出的值是一样的
	printf("变量a的大小是：%ld \n", sizeof(a)); // 4
	printf("指针p的大小是：%ld \n", sizeof(p)); // 8

	//　字符型测试　
	char c = 'A';
	char *ch = &c;
	printf("变量c的的大小是：%ld \n", sizeof(c)); // 1
	printf("指针ch的大小是：%ld \n", sizeof(ch)); // 8

	//　空指针大小测试
	char *x = NULL;
	printf("指针x的大小是：%ld \n", sizeof(x)); // 8

    return 0;
}
```



##### 4、指针运算

（1）算术运算

<img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/web/dengnaiwen/image-20240229154322939.png" alt="image-20240229154322939" style="zoom: 67%;" />

<font color='red'>注意：</font>**不同数据类型的两个指针实行加减整数运算是无意义的**

+：px + n 代表指针向地址大的方向移动 n 个 数据。移动后的地址量是 (px) + sizeof(px的类型) * n

-：px - n 代表指针向地址小的方向移动 n 个 数据。移动后的地址量是 (px) - sizeof(px的类型) * n

++：px++ 指针变量向地址大的方向移动一个数据

--：px-- 指针变量向地址小的方向移动一个数据

*(p++) 与 ++p 作用不同。 前者是先取 p的值，再使p自加。后者先使p自加，再取自加后指向的内
容。

++(*p)： 表示将p指向的元素的值加1.

示例代码：

```c
/***************************************************
# File Name:    指针04-指针的大小.c
# Author:       SuperYu
# Mail:         yujian001002@163.com.com
# Created Time: 2024年10月17日 星期四 23时45分42秒
****************************************************/

#include <stdio.h>
#include <stdbool.h>
#include <string.h>

int main() {
	// int 型测试	
	int a = 99;
	int *p = &a;
	
	printf("第一次，指针p存的地址：%p \n", p);

	// 指针向大的方向移一位
	p++;
	printf("第二次，指针p存的地址：%p \n", p);

	// 指针向大的方向移一位
	p++;
	printf("第三次，指针p存的地址：%p \n", p);

	// 指针向大的方向移两位
	p+=2;
	printf("第四次，指针p存的地址：%p \n", p);

    return 0;
}

//输出如下：
第一次，指针p存的地址：0x7ffcc44a388c 
第二次，指针p存的地址：0x7ffcc44a3890 
第三次，指针p存的地址：0x7ffcc44a3894 
第四次，指针p存的地址：0x7ffcc44a389c 
```

- 小结：

``` c
/***************************************************
# File Name:    58-指针初识
# Author:       SuperYu
# Mail:         yujian001002@163.com
# Created Time: 2024年12月31日 星期二 14时09分07秒
****************************************************/

#include <stdio.h>
#include <stdbool.h>
#include <string.h>
#include <time.h>
#include <stdlib.h>  // 包含这个头文件以使用 rand() 和 srand()

void testArr(int arr[]);

int main(int argc, char *argv[]) {
	// 1: 什么是指针:
	int a = 100;
	int *p = &a;   // 指针,存的是地址;
	
	// 2: 指针的使用 (解引用)
	printf("p指向的内在,实际值是:%d \n", *p );
	
	// 3: 指针大小: 指针本身的大小是:8个字节
	
	
	// 4: 指针的运算: ++ -- += -=
	// ++ 就代表指针向后移动一位, --就是向前移1位
	
	// 5: 指针与数组  
	// 数组名代表的就是,数组的0号位置的地址
	int arr[] = {11,22,33,44,55,66};
	int *p2 = arr;  // p2指向的就是数组的0号位置的地址
	
	p2++; // 相当于,从数组的0号位置 ,向后移动了一位,指向了数组的1号位置 
	
	printf("%d \n", *p2);
	
	// 6: 使用指针,去遍历数组
	int length = sizeof(arr) / sizeof(arr[0]);
	
	for(int i = 0; i < length; i++){
		// 形式1: 数组遍历完后,指针指向了数组的最后一个位置  
		//printf("%d \n", *p);
		//p++;
		
		// 形式2: 数组遍历完后,指针还是指向0号位置   
		printf("%d \n", *(p+i));
	}
	
    return 0;
}

```



**注意**：在指针移动之后的地址如果不是一个有效地址（自己没有初始化），那么此时访问指针对应地址空间里的数据会有很大的风险**：可能会导致程序崩溃或获取垃圾值等。**

因此，在C语言中，**总是应该确保指针指向的是有效的内存空间**，并且在访问之前这块内存已经被适当地初始化了。如果是动态分配的内存，应该在使用完毕后**适时地释放它**，以避免内存泄漏等问题。

- 练习一：

  > 创建一个长度为6的double类型的数组，使用指针遍历它。



- 练习二：
  - 已知一个数组的0号位置的地址是 int *start_p , 数组的最后一个位置的地址是 int *end_p
  - 需求：使用指针，遍历数组
  - 提示：指针可以相减求出距离的位数





- 四道练习：

  - 1：基础练习:输入a和b两个整数，按先大后小的顺序输出这两个整数。要求使用指针。

  

  - 2：实现利用指针倒序遍历一个数字数组

  

  - 3：编写一个程序实现功能:将字符串'Computer Science"赋给一个字符数组，然后从第一个字母开始间隔的输出该字符串，用指针完成。

  

  - 4：用指针来获取一个数组的最大值和最小值。
  
  
  
  - 5：用指针将整型组s[8]={1,2,3,4,5,6,7,8}中的值逆序存放（前置：指针完成两数交换）做了之后可以跳过第6题
    扩展：将该功能用函数来实现，即传递一个数组给函数，完成该函数的逆序存放
    扩展：可选题：利用指针完成冒泡排序



